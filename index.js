(()=>{"use strict";class e{constructor({name:e,link:t,likes:s,owner:r,_id:i},n,o,{handleCardClick:l,handleTrashClick:a,handleLikeClick:_,handleDislikeClick:c}){this._templateSelector=n,this._name=e,this._link=t,this._handleCardClick=l,this._likes=s,this._handleTrashClick=a,this._owner=r,this._id=i,this._handleLikeClick=_,this._handleDislikeClick=c,this._userId=o}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}_toggleLike(){this._likeButton.classList.toggle("element__like_active")}deleteCard(){this._element.remove(),this._element=null}updateLikeCounter(e){this._likeCounter.textContent=e.likes.length}_setEventListeners(){this._likeButton=this._element.querySelector(".element__like"),this._likeButton.addEventListener("click",(()=>{this._toggleLike(),this._likeButton.classList.contains("element__like_active")?this._handleLikeClick():this._handleDislikeClick()})),this._cardImage=this._element.querySelector(".element__image"),this._cardImage.addEventListener("click",(()=>this._handleCardClick(this._name,this._link))),this._trashButton=this._element.querySelector(".element__trash"),this._trashButton.addEventListener("click",(()=>this._handleTrashClick()))}generateCard(){return this._element=this._getTemplate(),this._setEventListeners(),this._cardImage.src=this._link,this._cardImage.alt=this._name,this._owner._id===this._userId&&this._trashButton.classList.add("element__trash_active"),this._likes.find((e=>e._id==this._userId))&&this._toggleLike(),this._cardName=this._element.querySelector(".element__title"),this._cardName.textContent=this._name,this._likeCounter=this._element.querySelector(".element__like-counter"),this._likeCounter.textContent=this._likes.length,this._element}}Array.from(document.querySelectorAll(".popup")),Array.from(document.querySelectorAll(".popup__button-close"));const t={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},s=document.querySelector(".profile__edit-button"),r=document.querySelector(".popup__input_value_name"),i=document.querySelector(".popup__input_value_about"),n=document.querySelector(".profile__add-button"),o=document.querySelector(".popup__form_block_elements"),l=document.querySelector(".popup__form_block_profile"),a=document.querySelector(".profile__avatar-container"),_=document.querySelector(".popup__form_avatar"),c=document.querySelector(".popup__button-confirm_profile"),h=document.querySelector(".popup__button-confirm_elements"),u=document.querySelector(".popup__button-confirm_avatar");class p{constructor(e,{inputSelector:t,submitButtonSelector:s,inactiveButtonClass:r,inputErrorClass:i,errorClass:n}){this._form=e,this._inputSelector=t,this._submitButtonSelector=s,this._inactiveButtonClass=r,this._inputErrorClass=i,this._errorClass=n}_setEventListeners(){this._inputList=Array.from(this._form.querySelectorAll(this._inputSelector)),this._buttonElement=this._form.querySelector(this._submitButtonSelector),this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))})),this._form.addEventListener("submit",(()=>{this._disableSubmitButton()}))}_toggleButtonState(){this._hasInvalidInput()?this._disableSubmitButton():this._enableSubmitButton()}_enableSubmitButton(){this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled")}_disableSubmitButton(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_showInputError(e){this._errorElement=this._form.querySelector(`.${e.id}-error`),e.classList.add(this._inputErrorClass),this._errorElement.textContent=e.validationMessage,this._errorElement.classList.add(this._errorClass)}_hideInputError(e){this._errorElement=this._form.querySelector(`.${e.id}-error`),e.classList.remove(this._inputErrorClass),this._errorElement.classList.remove(this._errorClass),this._errorElement.textContent=""}hideErrorOpened(){Array.from(this._form.querySelectorAll(this._inputSelector)).forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}enableValidation(){this._setEventListeners()}}class d{constructor(e){this._popup=document.querySelector(e)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}setEventListeners(){this._popup.querySelector(".popup__overlay").addEventListener("click",(()=>{this.close()})),this._popup.querySelector(".popup__button-close").addEventListener("click",(()=>{this.close()}))}}class m extends d{constructor(e,t){super(e),this._submiter=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=Array.from(this._form.querySelectorAll(".popup__input")),this._button=this._popup.querySelector(".popup__button-confirm")}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{this._button.textContent="Сохранение...",e.preventDefault(),this._submiter(this._getInputValues()),this.close()}))}close(){super.close(),this._form.reset()}}const k=new class extends d{constructor(e){super(e),this._buttonConfirmDelete=this._popup.querySelector(".popup__button-confirm_delete")}setActionSubmit(e){this._func=e}setEventListeners(){super.setEventListeners(),this._buttonConfirmDelete.addEventListener("click",(()=>{this._func(),console.log(this._func)}))}}(".popup_block_delete");k.setEventListeners();const b=new p(o,t),f=new p(l,t),v=new p(_,t),C=({name:t,link:s,likes:r,owner:i,_id:n})=>{const o=new e({name:t,link:s,likes:r,owner:i,_id:n},".element-template","8f24bc8a8cec8366252c30fd",{handleCardClick:(e,t)=>{g.open(e,t)},handleTrashClick:e=>{k.open(),k.setActionSubmit((()=>{o.deleteCard(),k.close(),I.deleteCard(o._id)}))},handleLikeClick:e=>{console.log(o._id),I.likeCard(o._id).then((e=>{o.updateLikeCounter(e)})).catch((e=>{console.log(`Ошибка: ${e}`)}))},handleDislikeClick:()=>{I.dislikeCard(o._id).then((e=>{o.updateLikeCounter(e)})).catch((e=>{console.log(`Ошибка: ${e}`)}))}});return o.generateCard()};b.enableValidation(),f.enableValidation(),v.enableValidation();const S=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}addItem(e,t){!0===t?this._container.prepend(e):this._container.append(e)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}}({renderer:e=>{const t=C(e);S.addItem(t,!1)}},".elements"),E=new class{constructor({profileNameSelector:e,profileAboutSelector:t,profileAvatarSelector:s}){this._profileName=document.querySelector(e),this._profileAbout=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._profileName.textContent,about:this._profileAbout.textContent}}setUserInfo({name:e,about:t}){this._profileName.textContent=e,this._profileAbout.textContent=t}setUserAvatar({avatar:e}){this._avatar.src=e}}({profileNameSelector:".profile__name",profileAboutSelector:".profile__about",profileAvatarSelector:".profile__avatar"}),y=new m(".popup_block_elements",(({name:e,link:t})=>{I.addNewCard(e,t).then((e=>{const t=C(e);S.addItem(t,!0)})).catch((e=>{console.log(`Ошибка: ${e}`)})).finally((()=>{h.textContent="Создать"}))}));y.setEventListeners(),n.addEventListener("click",(()=>{b.hideErrorOpened(),y.open()}));const L=new m(".popup_block_profile",(({name:e,about:t})=>{E.setUserInfo({name:e,about:t}),I.patchProfileInfo(e,t).finally((()=>{c.textContent="Сохранить"}))}));L.setEventListeners(),s.addEventListener("click",(()=>{const{name:e,about:t}=E.getUserInfo();r.value=e,i.value=t,f.hideErrorOpened(),L.open()}));const g=new class extends d{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._about=this._popup.querySelector(".popup__image-about")}open(e,t){super.open(),this._image.src=t,this._image.alt=e,this._about.textContent=e}}(".popup_block_image");g.setEventListeners();const q=new m(".popup_block_avatar",(({avatar:e})=>{E.setUserAvatar({avatar:e}),I.patchAvatar(e).finally((()=>{u.textContent="Сохранить"}))}));q.setEventListeners(),a.addEventListener("click",(()=>{v.hideErrorOpened(),q.open()}));const I=new class{constructor(e,t){this._baseUrl=e,this._headers=t}_checkResponse(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getProfileInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then((e=>this._checkResponse(e)))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then((e=>this._checkResponse(e)))}patchProfileInfo(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})})}addNewCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>this._checkResponse(e)))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then((e=>this._checkResponse(e)))}dislikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then((e=>this._checkResponse(e)))}patchAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}}("https://nomoreparties.co/v1/cohort-66",{authorization:"7b28846b-6feb-426f-b36e-edc1b9d97b68","Content-Type":"application/json"});I.getProfileInfo().then((e=>{E.setUserInfo(e),E.setUserAvatar(e),console.log(e)})).catch((e=>{console.log(`Ошибка: ${e}`)})),I.getInitialCards().then((e=>{S.renderItems(e),console.log(e)})).catch((e=>{console.log(`Ошибка: ${e}`)}))})();